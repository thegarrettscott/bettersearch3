(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{};!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===o.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,n=Math.min(65536,e.length+1),r=new Uint16Array(n),o=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(o.push(String.fromCharCode.apply(null,r.subarray(0,i))),!s)return o.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))r[i++]=s;else if(192==(224&s)){var a=63&e[t++];r[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var c=63&e[t++];r[i++]=(31&s)<<12|a<<6|c}else 240==(248&s)&&(65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(s-=65536,r[i++]=s>>>10&1023|55296,s=56320|1023&s),r[i++]=s)}}if(e.TextEncoder&&e.TextDecoder)return!1;var o=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,r=0,o=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(o>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(r+4>i.length&&(o+=8,o=(o*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(o)).set(i),i=a),0==(4294967168&s))i[r++]=s;else{if(0==(4294965248&s))i[r++]=s>>>6&31|192;else if(0==(4294901760&s))i[r++]=s>>>12&15|224,i[r++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[r++]=s>>>18&7|240,i[r++]=s>>>12&63|128,i[r++]=s>>>6&63|128}i[r++]=63&s|128}}return i.slice?i.slice(0,r):i.subarray(0,r)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var i=r;"function"==typeof Buffer&&Buffer.from?i=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){try{var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"})),n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return r(e)}finally{t&&URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:t);var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}var u={exports:{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const t="The message port closed before a response was received.",n="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(e,t){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const i=(t,n)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||r.length<=1&&!1!==n.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},s=e=>1==e?"argument":"arguments",a=(e,t)=>function(n,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((o,s)=>{if(t.fallbackToNoCallback)try{n[e](...r,i({resolve:o,reject:s},t))}catch(s){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,s),n[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(n[e](...r),o()):n[e](...r,i({resolve:o,reject:s},t))}))},c=(e,t,n)=>new Proxy(t,{apply:(t,r,o)=>n.call(r,e,...o)});let u=Function.call.bind(Object.prototype.hasOwnProperty);const l=(e,t={},n={})=>{let r=Object.create(null),o={has:(t,n)=>n in e||n in r,get(o,i,s){if(i in r)return r[i];if(!(i in e))return;let d=e[i];if("function"==typeof d)if("function"==typeof t[i])d=c(e,e[i],t[i]);else if(u(n,i)){let t=a(i,n[i]);d=c(e,e[i],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(u(t,i)||u(n,i)))d=l(d,t[i],n[i]);else{if(!u(n,"*"))return Object.defineProperty(r,i,{configurable:!0,enumerable:!0,get:()=>e[i],set(t){e[i]=t}}),d;d=l(d,t[i],n["*"])}return r[i]=d,d},set:(t,n,o,i)=>(n in r?r[n]=o:e[n]=o,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(r,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},i=Object.create(e);return new Proxy(i,o)},d=e=>({addListener(t,n,...r){t.addListener(e.get(n),...r)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),h=new o((e=>"function"!=typeof e?e:function(t){const n=l(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)}));let g=!1;const m=new o((e=>"function"!=typeof e?e:function(t,r,o){let i,s,a=!1,c=new Promise((e=>{i=function(t){g||(console.warn(n,(new Error).stack),g=!0),a=!0,e(t)}}));try{s=e(t,r,i)}catch(e){s=Promise.reject(e)}const u=!0!==s&&(e=>e&&"object"==typeof e&&"function"==typeof e.then)(s);if(!0!==s&&!u&&!a)return!1;return(e=>{e.then((e=>{o(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",o({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)}))})(u?s:c),!0})),f=({reject:n,resolve:r},o)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():n(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?n(new Error(o.message)):r(o)},p=(e,t,n,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const o=f.bind(null,{resolve:e,reject:t});r.push(o),n.sendMessage(...r)}))},v={devtools:{network:{onRequestFinished:d(h)}},runtime:{onMessage:d(m),onMessageExternal:d(m),sendMessage:p.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:p.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},w={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":w},services:{"*":w},websites:{"*":w}},l(e,v,r)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=r(chrome)}else e.exports=browser}(u);var l=u.exports,d=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise((function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())}))},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();function h(){return d.getInstance()}var g=function(){return crypto||window.msCrypto},m=function(){var e=g();return e.subtle||e.webkitSubtle},f=function(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",n="",r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n},p=function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",t="";return Array.from(g().getRandomValues(new Uint8Array(43))).forEach((function(n){return t+=e[n%e.length]})),t},v=function(e){return btoa(e)},w=function(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")},b=function(e){return s(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,m().digest({name:"SHA-256"},(new TextEncoder).encode(e))];case 1:return[2,t.sent()]}}))}))},A=function(e){return function(e){return decodeURIComponent((t=e,atob(t)).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));var t}(e.replace(/_/g,"/").replace(/-/g,"+"))},y=function(e){var t=new Uint8Array(e);return function(e){var t={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,(function(e){return t[e]}))}(v(String.fromCharCode.apply(String,Array.from(t))))},x=function(e){return new Promise((function(t){return setTimeout(t,e)}))},k=function(){function e(){this.waiters=void 0,this.acquiredIatSet=new Set,this.id=Date.now().toString()+f(15),void 0===this.waiters&&(this.waiters=[])}return e.prototype.acquireLock=function(e,t){return void 0===t&&(t=5e3),s(this,void 0,void 0,(function(){var n,r,o,i,s;return a(this,(function(a){switch(a.label){case 0:n=Date.now()+f(4),r=Date.now()+t,o="".concat("auth0-web-extension-lock-key","::").concat(e),a.label=1;case 1:return Date.now()<r?[4,x(30)]:[3,11];case 2:return a.sent(),[4,this.hasKey(o)];case 3:return a.sent()?[4,this.lockCorrector()]:[3,6];case 4:return a.sent(),[4,this.waitForSomethingToChange(r)];case 5:return a.sent(),[3,10];case 6:return[4,this.setItem(o,JSON.stringify({id:this.id,iat:n,timeUpdated:Date.now()}))];case 7:return a.sent(),[4,x(30)];case 8:return a.sent(),[4,this.getItem(o)];case 9:if(null!==(i=a.sent())&&(s=JSON.parse(i)).id===this.id&&s.iat===n)return this.acquiredIatSet.add(n),this.refreshLock(e,n),[2,!0];a.label=10;case 10:return n=Date.now()+f(4),[3,1];case 11:return[2,!1]}}))}))},e.prototype.releaseLock=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return t="".concat("auth0-web-extension-lock-key","::").concat(e),[4,this.getItem(t)];case 1:return null===(n=o.sent())?[2]:(r=JSON.parse(n)).id!==this.id?[3,4]:[4,h().lock(r.iat)];case 2:return o.sent(),this.acquiredIatSet.delete(r.iat),[4,this.removeItem(t)];case 3:o.sent(),h().unlock(r.iat),this.notifyWaiters(),o.label=4;case 4:return[2]}}))}))},e.prototype.refreshLock=function(e,t){return s(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){return setTimeout((function(){return s(n,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return[4,h().lock(t)];case 1:return o.sent(),this.acquiredIatSet.has(t)?[4,this.getItem(e)]:(h().unlock(t),[2]);case 2:return null===(n=o.sent())?[3,4]:((r=JSON.parse(n)).timeUpdated=Date.now(),[4,this.setItem(e,JSON.stringify(r))]);case 3:return o.sent(),h().unlock(t),[3,5];case 4:return h().unlock(t),[2];case 5:return this.refreshLock(e,t),[2]}}))}))}),1e3),[2]}))}))},e.prototype.lockCorrector=function(){var e,t;return s(this,void 0,void 0,(function(){var n,r,o,i,s,u,l,d;return a(this,(function(a){switch(a.label){case 0:return n=Date.now()-5e3,[4,this.allKeys()];case 1:r=a.sent(),o=!1,a.label=2;case 2:a.trys.push([2,8,9,14]),i=c(r),a.label=3;case 3:return[4,i.next()];case 4:return(s=a.sent()).done?[3,7]:(u=s.value).includes("auth0-web-extension-lock-key")?[4,this.getItem(u)]:[3,6];case 5:null!==(l=a.sent())&&JSON.parse(l).timeUpdated<n&&(this.removeItem(u),o=!0),a.label=6;case 6:return[3,3];case 7:return[3,14];case 8:return d=a.sent(),e={error:d},[3,14];case 9:return a.trys.push([9,,12,13]),s&&!s.done&&(t=i.return)?[4,t.call(i)]:[3,11];case 10:a.sent(),a.label=11;case 11:return[3,13];case 12:if(e)throw e.error;return[7];case 13:return[7];case 14:return o&&this.notifyWaiters(),[2]}}))}))},e.prototype.waitForSomethingToChange=function(e){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){var r=!1,o=Date.now(),i=!1,s=function(){if(i||(l.storage.onChanged.removeListener(s),t.removeFromWaiting(s),clearTimeout(a),i=!0),!r){r=!0;var e=50-(Date.now()-o);e>0?setTimeout(n,e):n()}};l.storage.onChanged.addListener(s),t.addToWaiting(s);var a=setTimeout(s,Math.max(0,e-Date.now()))}))];case 1:return n.sent(),[2]}}))}))},e.prototype.addToWaiting=function(e){this.removeFromWaiting(e),void 0!==this.waiters&&this.waiters.push(e)},e.prototype.removeFromWaiting=function(e){void 0!==this.waiters&&(this.waiters=this.waiters.filter((function(t){return t!==e})))},e.prototype.notifyWaiters=function(){void 0!==this.waiters&&function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],this.waiters,!0).forEach((function(e){return e()}))},e.prototype.allKeys=function(){return s(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,l.storage.local.get(null)];case 1:return e=t.sent(),[2,Object.keys(e)]}}))}))},e.prototype.hasKey=function(e){return s(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,l.storage.local.get(e)];case 1:return t=n.sent(),[2,Boolean(null==t?void 0:t[e])]}}))}))},e.prototype.setItem=function(e,t){return s(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,l.storage.local.set((n={},n[e]=t,n))];case 1:return[2,r.sent()]}}))}))},e.prototype.getItem=function(e){return s(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,l.storage.local.get(e)];case 1:return[2,(null==(t=n.sent())?void 0:t[e])||null]}}))}))},e.prototype.removeItem=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,l.storage.local.remove(e)];case 1:return[2,t.sent()]}}))}))},e}(),_=function(){function e(){}return e.prototype.sendTabMessage=function(e,t){var n=o(o({},t),{source:"auth0-web-extension"});return l.tabs.sendMessage(e,n)},e.prototype.sendRuntimeMessage=function(e){var t=o(o({},e),{source:"auth0-web-extension"});return l.runtime.sendMessage(void 0,t)},e.prototype.addMessageListener=function(e){l.runtime.onMessage.addListener((function(t,n){if("auth0-web-extension"===t.source)return e(t,n)}))},e}(),T=function(){function e(e,t){this.storage=e,this.clientId=t,this.storageKey="".concat("a0.webext.txs",".").concat(this.clientId),this.transaction=this.storage.get(this.storageKey)}return e.prototype.create=function(e){this.transaction=e,this.storage.save(this.storageKey,e,{daysUntilExpire:1})},e.prototype.get=function(){return this.transaction},e.prototype.remove=function(){delete this.transaction,this.storage.remove(this.storageKey)},e}(),S=["login_required","consent_required","interaction_required","account_selection_required","access_denied"],C=function(){return Date.now()},I=function(e){function t(n,r){var o=e.call(this,r)||this;return o.error=n,o.error_description=r,Object.setPrototypeOf(o,t.prototype),o}return r(t,e),t.fromPayload=function(e){return new t(e.error,e.error_description)},t}(Error),E=function(e){function t(n,r,o,i){void 0===i&&(i=null);var s=e.call(this,n,r)||this;return s.state=o,s.appState=i,Object.setPrototypeOf(s,t.prototype),s}return r(t,e),t}(I),P=function(e){function t(){var n=e.call(this,"timeout","Timeout")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(I),O=function(e){function t(n,r,o){var i=e.call(this,n,r)||this;return i.mfa_token=o,Object.setPrototypeOf(i,t.prototype),i}return r(t,e),t}(I),U=function(e,t){return s(void 0,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return[4,fetch(e,t)];case 1:return n=o.sent(),r={ok:n.ok},[4,n.json()];case 2:return[2,(r.json=o.sent(),r)]}}))}))},M=function(e,t,n){return void 0===n&&(n=1e4),s(void 0,void 0,void 0,(function(){var r,o;return a(this,(function(i){return r=new AbortController,t.signal=r.signal,[2,Promise.race([U(e,t),new Promise((function(e,t){o=setTimeout((function(){r.abort(),t(new Error("Timeout when executing 'fetch'"))}),n)}))]).finally((function(){clearTimeout(o)}))]}))}))};function j(e,t,n){return s(this,void 0,void 0,(function(){var r,o,s,c,u,l,d,h,g;return a(this,(function(a){switch(a.label){case 0:r=null,s=0,a.label=1;case 1:if(!(s<3))return[3,6];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,M(e,t,n)];case 3:return o=a.sent(),r=null,[3,6];case 4:return c=a.sent(),r=c,[3,5];case 5:return s++,[3,1];case 6:if(r)throw r.message=r.message||"Failed to fetch",r;if(u=o.json,l=u.error,d=u.error_description,h=i(u,["error","error_description"]),!o.ok){if(g=d||"HTTP error. Unable to fetch ".concat(e),"mfa_required"===l)throw new O(l,g,h.mfa_token);throw new I(l||"request_error",g)}return[2,h]}}))}))}function D(e){var t=e.baseUrl,n=e.timeout;e.audience,e.scope;var r=e.useFormData,o=i(e,["baseUrl","timeout","audience","scope","useFormData"]);return s(this,void 0,void 0,(function(){var e;return a(this,(function(i){switch(i.label){case 0:return e=r?w(o):JSON.stringify(o),[4,j("".concat(t,"/oauth/token"),{method:"POST",body:e,headers:{"Content-Type":r?"application/x-www-form-urlencoded":"application/json"}},n)];case 1:return[2,i.sent()]}}))}))}var L,R=function(e){return"number"==typeof e},F=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],z=function(e){if(!e.id_token)throw new Error("ID token is required but missing");var t=function(e){var t=e.split("."),n=t[0],r=t[1],o=t[2];if(3!==t.length||!n||!r||!o)throw new Error("ID token could not be decoded");var i=JSON.parse(A(r)),s={__raw:e},a={};return Object.keys(i).forEach((function(e){s[e]=i[e],F.includes(e)||(a[e]=i[e])})),{encoded:{header:n,payload:r,signature:o},header:JSON.parse(A(n)),claims:s,user:a}}(e.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==e.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(e.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==e.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(e.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==e.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but found "').concat(t.claims.aud,'"'));if(e.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==e.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(e.nonce,'", found "').concat(t.claims.nonce,'"'))}if(e.max_age&&!R(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(!R(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!R(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");var n=e.leeway||60,r=new Date(e.now||Date.now()),o=new Date(0),i=new Date(0),s=new Date(0);if(s.setUTCSeconds(parseInt(t.claims.auth_time)+e.max_age+n),o.setUTCSeconds(t.claims.exp+n),i.setUTCSeconds(t.claims.nbf-n),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(R(t.claims.nbf)&&r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Currrent time (".concat(r,") is before ").concat(i));if(R(t.claims.auth_time)&&r>s)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Currrent time (".concat(r,") is after last auth at ").concat(s));if(e.organizationId){if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(e.organizationId!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(e.organizationId,'", found "').concat(t.claims.org_id,'"'))}return t},K=function(e){return Array.from(new Set(e))},N=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return K(e.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},q=function(){function e(){this.storage={}}return e.prototype.get=function(e){var t=this.storage[e];if(void 0!==t)return JSON.parse(t)},e.prototype.save=function(e,t){this.storage[e]=JSON.stringify(t)},e.prototype.remove=function(e){delete this.storage[e]},e}(),B=function(){var e;this.enclosedCache=(e={},{set:function(t,n){e[t]=n},get:function(t){return e[t]||null},remove:function(t){delete e[t]},allKeys:function(){return Object.keys(e)}})},W=function(){function e(e,t){void 0===t&&(t="@@auth0webext@@"),this.prefix=t,this.client_id=e.client_id,this.scope=e.scope,this.audience=e.audience}return e.prototype.toKey=function(){return"".concat(this.prefix,"::").concat(this.client_id,"::").concat(this.audience,"::").concat(this.scope)},e.fromKey=function(t){var n=t.split("::"),r=n[0],o=n[1],i=n[2],s=n[3];return r&&o&&s&&i?new e({client_id:o,scope:s,audience:i},r):null},e.fromCacheEntry=function(t){return new e({scope:t.scope,audience:t.audience,client_id:t.client_id})},e}(),$=function(){function e(e,t,n){this.cache=e,t&&(this.keyManifest=t),this.nowProvider=n||C}return e.prototype.get=function(e,t){var n;return void 0===t&&(t=0),s(this,void 0,void 0,(function(){var r,o,i,s,c;return a(this,(function(a){switch(a.label){case 0:return[4,this.cache.get(e.toKey())];case 1:return(r=a.sent())?[3,4]:[4,this.getCacheKeys()];case 2:return(o=a.sent())&&(i=this.matchExistingCacheKey(e,o))?[4,this.cache.get(i)]:[2];case 3:r=a.sent(),a.label=4;case 4:return r?[4,this.nowProvider()]:[2];case 5:return s=a.sent(),c=Math.floor(s/1e3),r.expiresAt-t<c?r.body.refresh_token?(r.body={refresh_token:r.body.refresh_token},[4,this.cache.set(e.toKey(),r)]):[3,7]:[3,10];case 6:return a.sent(),[2,r.body];case 7:return[4,this.cache.remove(e.toKey())];case 8:return a.sent(),[4,null===(n=this.keyManifest)||void 0===n?void 0:n.remove(e.toKey())];case 9:return a.sent(),[2];case 10:return[2,r.body]}}))}))},e.prototype.set=function(e){var t;return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return n=new W({client_id:e.client_id,scope:e.scope,audience:e.audience}),[4,this.wrapCacheEntry(e)];case 1:return r=o.sent(),[4,this.cache.set(n.toKey(),r)];case 2:return o.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.add(n.toKey())];case 3:return o.sent(),[2]}}))}))},e.prototype.clear=function(e){var t;return s(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(o){switch(o.label){case 0:return[4,this.getCacheKeys()];case 1:return(n=o.sent())?[4,n.filter((function(t){return!e||t.includes(e)})).reduce((function(e,t){return s(r,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,this.cache.remove(t)];case 2:return n.sent(),[2]}}))}))}),Promise.resolve())]:[2];case 2:return o.sent(),[4,null===(t=this.keyManifest)||void 0===t?void 0:t.clear()];case 3:return o.sent(),[2]}}))}))},e.prototype.clearSync=function(e){var t,n,r=this,o=null===(n=(t=this.cache).allKeys)||void 0===n?void 0:n.call(t);o&&o.filter((function(t){return!e||t.includes(e)})).forEach((function(e){r.cache.remove(e)}))},e.prototype.wrapCacheEntry=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return t=o.sent(),n=Math.floor(t/1e3)+e.expires_in,r=Math.min(n,e.decodedToken.claims.exp),[2,{body:e,expiresAt:r}]}}))}))},e.prototype.getCacheKeys=function(){var e,t;return s(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this.keyManifest?[4,this.keyManifest.get()]:[3,2];case 1:return[2,(n.sent()||{}).keys||[]];case 2:return[4,null===(t=(e=this.cache).allKeys)||void 0===t?void 0:t.call(e)];case 3:return[2,n.sent()||[]]}}))}))},e.prototype.matchExistingCacheKey=function(e,t){return t.filter((function(t){var n=W.fromKey(t),r=new Set((null==n?void 0:n.scope)&&n.scope.split(" ")),o=e.scope.split(" "),i=(null==n?void 0:n.scope)&&o.reduce((function(e,t){return e&&r.has(t)}),!0);return"@@auth0webext@@"===(null==n?void 0:n.prefix)&&n.client_id===e.client_id&&n.audience===e.audience&&i}))[0]},e}(),J=function(){function e(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}return e.prototype.add=function(e){var t;return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return r=Set.bind,[4,this.cache.get(this.manifestKey)];case 1:return(n=new(r.apply(Set,[void 0,(null===(t=o.sent())||void 0===t?void 0:t.keys)||[]]))).add(e),[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})];case 2:return o.sent(),[2]}}))}))},e.prototype.remove=function(e){return s(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,this.cache.get(this.manifestKey)];case 1:return(t=r.sent())?((n=new Set(t.keys)).delete(e),n.size>0?[4,this.cache.set(this.manifestKey,{keys:Array.from(n.values())})]:[3,3]):[3,5];case 2:case 4:return[2,r.sent()];case 3:return[4,this.cache.remove(this.manifestKey)];case 5:return[2]}}))}))},e.prototype.get=function(){return this.cache.get(this.manifestKey)},e.prototype.clear=function(){return this.cache.remove(this.manifestKey)},e.prototype.createManifestKeyFrom=function(e){return"".concat("@@auth0webext@@","::").concat(e)},e}(),H={},Z=function(e,t,n){void 0===n&&(n=!1),console.log("[auth0-web-extension] singlePromise() key",t);var r=H[t];return n||r?n&&(r=e()):(console.log("[auth0-web-extension] singlePromise() there is no promise"),r=e().finally((function(){console.log("[auth0-web-extension] singlePromise() completing finally"),delete H[t],r=void 0})),H[t]=r),r},V=function(e,t){return void 0===t&&(t=3),s(void 0,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:n=0,r.label=1;case 1:return n<t?[4,e()]:[3,4];case 2:if(r.sent())return[2,!0];r.label=3;case 3:return n++,[3,1];case 4:return[2,!1]}}))}))},G=new k,X=(function(){function e(e){var t,n,r,o=this;if(this.options=e,this.options.debug&&console.log("[auth0-web-extension] - constructor"),function(){if(!g())throw new Error("For security reasons, `window.crypto` is required to run `auth0-web-extension`.");if(void 0===m())throw new Error("\n      auth0-web-extension must run on a secure origin.\n    ")}(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache,this.cacheLocation="memory";else{this.cacheLocation=e.cacheLocation||"memory";var i=ee(this.cacheLocation);if(!i)throw new Error('Invalid cache location "'.concat(this.cacheLocation,'"'));r=i()}var s=new q;this.transactionManager=new T(s,this.options.client_id),this.messenger=new _,this.scope=this.options.scope,this.nowProvider=this.options.nowProvider||C,this.cacheManager=new $(r,r.allKeys?null:new J(r,this.options.client_id),this.nowProvider),this.options.debug&&console.log("[auth0-web-extension] - Auth0Client constructor, getting domainUrl"),this.domainUrl=Q(this.options.domain),this.tokenIssuer=te(this.options.issuer,this.domainUrl),this.defaultScope=N("openid",void 0!==(null===(n=null===(t=this.options)||void 0===t?void 0:t.advancedOptions)||void 0===n?void 0:n.defaultScope)?this.options.advancedOptions.defaultScope:"openid profile email"),this.options.useRefreshTokens,this.customOptions=ne(e),this.options.debug&&console.log("[auth0-web-extension] - Ading message listener to this"),this.messenger.addMessageListener((function(e,t){var n,r;switch(o.options.debug&&console.log("[auth0-web-extension] - Message recieved",e),e.type){case"auth-result":return(null===(n=t.tab)||void 0===n?void 0:n.id)&&o.messenger.sendTabMessage(t.tab.id,{type:"auth-cleanup"}),o.options.debug&&console.log("[auth0-web-extension] Received authentication result back, cleaning up..."),new Promise((function(t){o._handleAuthorizeResponse(e.payload).then((function(){return t()}))}));case"auth-error":return null==(i=o.transactionManager.get())||i.errorCallback(e.error),(null===(r=t.tab)||void 0===r?void 0:r.id)&&o.messenger.sendTabMessage(t.tab.id,{type:"auth-cleanup"}),Promise.resolve();case"auth-params":var i=o.transactionManager.get();return o.options.debug&&console.log("[auth0-web-extension] Sending authorize url to content script: ",i),i?Promise.resolve({authorizeUrl:i.authorizeUrl,domainUrl:i.domainUrl}):Promise.resolve();default:throw new Error("Invalid message type ".concat(e.type))}})),this.options.debug&&console.log("[auth0-web-extension] - finished adding message listener")}e.prototype._url=function(e){return"".concat(this.domainUrl).concat(e)},e.prototype._getParams=function(e,t,n,r,s){var a=this.options;a.useRefreshTokens,a.useCookiesForTransactions,a.useFormData,a.auth0Client,a.cacheLocation,a.advancedOptions,a.detailedResponse,a.nowProvider,a.authorizeTimeoutInSeconds,a.legacySameSiteCookie,a.sessionCheckExpiryDays,a.domain,a.leeway;var c=i(a,["useRefreshTokens","useCookiesForTransactions","useFormData","auth0Client","cacheLocation","advancedOptions","detailedResponse","nowProvider","authorizeTimeoutInSeconds","legacySameSiteCookie","sessionCheckExpiryDays","domain","leeway"]);return o(o(o({},c),e),{scope:N(this.defaultScope,this.scope,e.scope),response_type:"code",response_mode:"query",state:t,nonce:n,redirect_uri:s||this.options.redirect_uri,code_challenge:r,code_challenge_method:"S256"})},e.prototype._authorizeUrl=function(e){return this._url("/authorize?".concat(w(e)))},e.prototype.getUser=function(e){var t;return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var n,r,o,i;return a(this,(function(s){switch(s.label){case 0:return this.options.debug&&console.log("[auth0-web-extension] - getUser"),n=e.audience||this.options.audience||"default",r=N(this.defaultScope,this.scope,e.scope),o=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60,this.options.debug&&console.log("[auth0-web-extension] - checking session"),[4,this.checkSession({audience:n,scope:r,timeoutInSeconds:o})];case 1:return s.sent(),[4,this.cacheManager.get(new W({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return i=s.sent(),[2,null===(t=null==i?void 0:i.decodedToken)||void 0===t?void 0:t.user]}}))}))},e.prototype.getIdTokenClaims=function(e){var t;return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(i){switch(i.label){case 0:return n=e.audience||this.options.audience||"default",r=N(this.defaultScope,this.scope,e.scope),this.options.debug&&console.log("[auth0-web-extension] - checking session"),[4,this.checkSession({audience:n,scope:r})];case 1:return i.sent(),[4,this.cacheManager.get(new W({client_id:this.options.client_id,audience:n,scope:r}))];case 2:return o=i.sent(),[2,null===(t=null==o?void 0:o.decodedToken)||void 0===t?void 0:t.claims]}}))}))},e.prototype.loginWithNewTab=function(e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var t,n,r,o,c,u,d,h,g,m,f,w,A=this;return a(this,(function(x){switch(x.label){case 0:return t=e.redirect_uri,n=e.appState,r=i(e,["redirect_uri","appState"]),o=v(p()),c=v(p()),u=p(),[4,b(u)];case 1:return d=x.sent(),h=y(d),g=e.fragment?"#".concat(e.fragment):"",m=this._getParams(r,o,c,h,t),f=this._authorizeUrl(m),w=f+g,[4,V((function(){return G.acquireLock("auth0.lock.getTokenSilently",5e3)}),10)];case 2:if(!x.sent())return[3,8];x.label=3;case 3:return x.trys.push([3,,5,7]),[4,new Promise((function(e,t){return s(A,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return this.transactionManager.create({authorizeUrl:w,domainUrl:this.domainUrl,nonce:c,code_verifier:u,appState:n,scope:m.scope,audience:m.audience||"default",redirect_uri:m.redirect_uri,state:o,callback:e,errorCallback:t}),[4,l.tabs.create({url:f})];case 1:return r.sent(),[2]}}))}))}))];case 4:return x.sent(),[3,7];case 5:return[4,G.releaseLock("auth0.lock.getTokenSilently")];case 6:return x.sent(),this.options.debug&&console.log("[auth0-web-extension] - lock released"),[7];case 7:return[3,9];case 8:throw new P;case 9:return[2]}}))}))},e.prototype.loginWithPopup=function(e,t){return s(this,void 0,void 0,(function(){var t,n,r,c,u,d,h,g,m,f,w=this;return a(this,(function(A){switch(A.label){case 0:return t=i(e=e||{},[]),n=v(p()),r=v(p()),c=p(),[4,b(c)];case 1:return u=A.sent(),d=y(u),h=this._getParams(t,n,r,d,this.options.redirect_uri),g=this._authorizeUrl(o(o({},h),{response_mode:"query"})),m=400,f=600,[4,V((function(){return G.acquireLock("auth0.lock.getTokenSilently",5e3)}),10)];case 2:if(!A.sent())return[3,7];A.label=3;case 3:return A.trys.push([3,,4,6]),[2,new Promise((function(e,t){return s(w,void 0,void 0,(function(){var o,i;return a(this,(function(s){switch(s.label){case 0:return[4,l.windows.create({width:m,height:f,type:"popup",url:g})];case 1:return o=s.sent(),i=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];o.id&&l.windows.remove(o.id),e(t)}},this.transactionManager.create({authorizeUrl:g,domainUrl:this.domainUrl,nonce:r,code_verifier:c,scope:h.scope,audience:h.audience||"default",redirect_uri:h.redirect_uri,state:n,callback:i(e),errorCallback:i(t)}),[2]}}))}))}))];case 4:return[4,G.releaseLock("auth0.lock.getTokenSilently")];case 5:return A.sent(),this.options.debug&&console.log("[auth0-web-extension] - lock released"),[7];case 6:return[3,8];case 7:throw new P;case 8:return[2]}}))}))},e.prototype._handleAuthorizeResponse=function(e){return s(this,void 0,void 0,(function(){var t,n,r,i,s,c,u,l,d,h;return a(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,4,5,6]),t=e.error,n=void 0===t?"":t,r=e.error_description,i=void 0===r?"":r,s=e.state,c=e.code,!(h=this.transactionManager.get()))throw new Error("Invalid state");if(this.options.debug&&console.log("[auth0-web-extension] Unregistering current transaction"),e.error)throw new E(n,i,e.state,h.appState);if(!h.code_verifier||h.state&&h.state!==s)throw new Error("Invalid state");return[4,D(o(o({},this.customOptions),{audience:h.audience,scope:h.scope,redirect_uri:h.redirect_uri||this.options.redirect_uri,baseUrl:this.domainUrl,client_id:this.options.client_id,code_verifier:h.code_verifier,grant_type:"authorization_code",code:c,useFormData:this.options.useFormData}))];case 1:return u=a.sent(),this.options.debug&&console.log("[auth0-web-extension] Received token using code and verifier"),[4,this._verifyIdToken(u.id_token,h.nonce)];case 2:return l=a.sent(),[4,this.cacheManager.set(o(o(o(o({},u),{decodedToken:l,audience:h.audience,scope:h.scope}),u.scope?{oauthTokenScope:u.scope}:null),{client_id:this.options.client_id}))];case 3:return a.sent(),this.options.debug&&console.log("[auth0-web-extension] Stored token in cache"),h.callback(o(o({},u),{decodedToken:l,scope:h.scope,oauthTokenScope:h.scope,audience:h.audience})),[3,6];case 4:return d=a.sent(),null==(h=this.transactionManager.get())||h.errorCallback(d),[3,6];case 5:return this.transactionManager.remove(),[7];case 6:return[2]}}))}))},e.prototype.isAuthenticated=function(){return s(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return this.options.debug&&console.log("[auth0-web-extension] - isAuthenticated"),[4,this.getUser()];case 1:return e=t.sent(),[2,Boolean(e)]}}))}))},e.prototype.checkSession=function(e){return s(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getTokenSilently(e)];case 1:return n.sent(),[3,3];case 2:if(t=n.sent(),!S.includes(t.error))throw t;return[3,3];case 3:return[2]}}))}))},e.prototype.getTokenSilently=function(e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return this.options.debug&&console.log("[auth0-web-extension] - prepare getTokenSilently"),[2,Z((function(){return t._getTokenSilently(o(o({audience:t.options.audience,ignoreCache:!1},e),{scope:N(t.defaultScope,t.scope,e.scope)}))}),"".concat(this.options.client_id,"::").concat(this.options.audience,"::").concat(N(this.defaultScope,this.scope,e.scope)),!0)]}))}))},e.prototype._getTokenSilently=function(e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var t,n,r,s,c,u,l,d,h,g,m,f,p;return a(this,(function(a){switch(a.label){case 0:return this.options.debug&&console.log("[auth0-web-extension] - getTokenSilently"),t=e.ignoreCache,n=i(e,["ignoreCache"]),t||!n.scope?[3,2]:[4,this._getEntryFromCache({scope:n.scope,audience:n.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 1:if(r=a.sent())return this.options.debug&&console.log("[auth0-web-extension] - cache hit! returning token"),[2,r];this.options.debug&&console.log("[auth0-web-extension] - no cache hit, continuing"),a.label=2;case 2:return this.options.debug&&console.log("[auth0-web-extension] - waiting for lock"),[4,V((function(){return G.acquireLock("auth0.lock.getTokenSilently",5e3)}),10)];case 3:if(!a.sent())return[3,15];this.options.debug&&console.log("[auth0-web-extension] - lock acquired!"),a.label=4;case 4:return a.trys.push([4,,12,14]),t||!n.scope?[3,6]:[4,this._getEntryFromCache({scope:n.scope,audience:n.audience||"default",client_id:this.options.client_id,getDetailedEntry:e.detailedResponse})];case 5:if(r=a.sent())return this.options.debug&&console.log("[auth0-web-extension] - cache hit! returning token"),[2,r];this.options.debug&&console.log("[auth0-web-extension] - no hit, continuing"),a.label=6;case 6:return s=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60,c=new Promise((function(e,t){setTimeout((function(){return t(new P)}),1e3*s)})),this.options.debug&&console.log("[auth0-web-extension] - checking auth"),d=(l=Promise).race,this.options.useRefreshTokens?[4,this._getTokenUsingRefreshToken(n)]:[3,8];case 7:return h=a.sent(),[3,10];case 8:return[4,this._getTokenFromIFrame(n)];case 9:h=a.sent(),a.label=10;case 10:return[4,d.apply(l,[[h,c]])];case 11:return u=a.sent(),this.options.debug&&console.log("[auth0-web-extension] - authResult",u),e.detailedResponse?(this.options.debug&&console.log("[auth0-web-extension] - giving detailed response"),g=u.id_token,m=u.access_token,f=u.oauthTokenScope,p=u.expires_in,[2,o(o({id_token:g,access_token:m},f?{scope:f}:null),{expires_in:p})]):[2,u.access_token];case 12:return this.options.debug&&console.log("[auth0-web-extension] - releasing lock"),[4,G.releaseLock("auth0.lock.getTokenSilently")];case 13:return a.sent(),this.options.debug&&console.log("[auth0-web-extension] - lock released"),[7];case 14:return[3,16];case 15:throw this.options.debug&&console.log("[auth0-web-extension] - timed out get token silently"),new P;case 16:return[2]}}))}))},e.prototype._getTokenUsingRefreshToken=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(e){throw"We currently don't support using refresh tokens, set useRefreshTokens to false"}))}))},e.prototype._getTokenFromIFrame=function(e){return s(this,void 0,void 0,(function(){var t,n,r,i,c,u,l,d,h,g=this;return a(this,(function(m){switch(m.label){case 0:return t=v(p()),n=v(p()),r=p(),[4,b(r)];case 1:i=m.sent(),c=y(i),this.options.debug&&console.log("[auth0-web-extension] - getTokenFromIFrame"),u=this._getParams(e,t,n,c,e.redirect_uri||this.options.redirect_uri),l=this._authorizeUrl(o(o({},u),{prompt:"none",response_mode:"web_message"})),this.options.debug&&console.log("[auth0-web-extension] - built authorize url"),m.label=2;case 2:return m.trys.push([2,5,,6]),this.options.debug&&console.log("[auth0-web-extension] - checking if current tab has content script running"),[4,(f=this._getTabId.bind(this),w=10,void 0===w&&(w=3),s(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:e=0,t.label=1;case 1:if(!(e<w))return[3,6];t.label=2;case 2:return t.trys.push([2,4,,5]),[4,f()];case 3:return[2,t.sent()];case 4:return t.sent(),[3,5];case 5:return e++,[3,1];case 6:return[2,null]}}))})))];case 3:if(!(d=m.sent()))throw"Failed to connect to tab too many times";return[4,this.messenger.sendTabMessage(d,{type:"auth-start"})];case 4:return m.sent(),this.options.debug&&console.log("[auth0-web-extension] - sent auth-start message to content script"),[2,new Promise((function(e,o){g.transactionManager.create({authorizeUrl:l,domainUrl:g.domainUrl,nonce:n,code_verifier:r,scope:u.scope,audience:u.audience||"default",redirect_uri:u.redirect_uri,state:t,callback:e,errorCallback:o})}))];case 5:throw(h=m.sent()).error,h;case 6:return[2]}var f,w}))}))},e.prototype._getTabId=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,o;return a(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),this.options.debug&&console.log("[auth0-web-extension] - checking current tab id"),e={active:!0,currentWindow:!0},[4,l.tabs.query(e)];case 1:return t=i.sent()[0],n=(t||{}).id,this.options.debug&&console.log("[auth0-web-extension] - current tab id ".concat(n)),n?[4,this.messenger.sendTabMessage(n,{type:"auth-ack"})]:[3,3];case 2:if(r=i.sent(),this.options.debug&&console.log("[auth0-web-extension] - received response from current tab",r),"ack"===r)return[2,n];throw new Error("Received invalid response on acknowledgement");case 3:this.options.debug&&console.log("[auth0-web-extension] - no current tab, waiting for one"),i.label=4;case 4:return[3,6];case 5:throw o=i.sent(),this.options.debug&&console.log("[auth0-web-extension] - ".concat(o)),o;case 6:throw"Could not access current tab."}}))}))},e.prototype._verifyIdToken=function(e,t,n){return s(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return[4,this.nowProvider()];case 1:return r=o.sent(),[2,z({iss:this.tokenIssuer,aud:this.options.client_id,id_token:e,nonce:t,organizationId:n,leeway:this.options.leeway,max_age:X(this.options.max_age),now:r})]}}))}))},e.prototype._getEntryFromCache=function(e){var t=e.scope,n=e.audience,r=e.client_id,i=e.getDetailedEntry,c=void 0!==i&&i;return s(this,void 0,void 0,(function(){var e,i,s,u,l;return a(this,(function(a){switch(a.label){case 0:return[4,this.cacheManager.get(new W({scope:t,audience:n,client_id:r}),60)];case 1:return(e=a.sent())&&e.access_token?c?(i=e.id_token,s=e.access_token,u=e.oauthTokenScope,l=e.expires_in,i&&l?[2,o(o({id_token:i,access_token:s},u?{scope:u}:null),{expires_in:l})]:[2,void 0]):[2,e.access_token]:[2]}}))}))}}(),function(e){return"string"!=typeof e?e:parseInt(e,10)||void 0}),Q=function(e){return/^https?:\/\//.test(e)?e:"https://".concat(e)},Y=((L={}).memory=function(){return(new B).enclosedCache},L),ee=function(e){return Y[e]},te=function(e,t){return e?e.startsWith("https://")?e:"https://".concat(e,"/"):"".concat(t,"/")},ne=function(e){return e.advancedOptions,e.audience,e.auth0Client,e.authorizeTimeoutInSeconds,e.cacheLocation,e.client_id,e.domain,e.issuer,e.leeway,e.max_age,e.redirect_uri,e.scope,e.useRefreshTokens,e.useCookiesForTransactions,e.useFormData,i(e,["advancedOptions","audience","auth0Client","authorizeTimeoutInSeconds","cacheLocation","client_id","domain","issuer","leeway","max_age","redirect_uri","scope","useRefreshTokens","useCookiesForTransactions","useFormData"])};var re=function(e,t,n,r){return void 0===n&&(n=60),s(void 0,void 0,void 0,(function(){return a(this,(function(o){return r&&console.log("[auth0-web-extension] runIFrame",e),[2,new Promise((function(o,i){var s=window.document.createElement("iframe");s.setAttribute("width","0"),s.setAttribute("height","0"),s.style.display="none",r&&console.log("[auth0-web-extension] created authorize iframe");var a,c=function(){window.document.body.contains(s)&&(r&&console.log("[auth0-web-extension] removing authorize iframe"),window.document.body.removeChild(s),window.removeEventListener("message",a,!1))},u=setTimeout((function(){i(new P),c()}),1e3*n);a=function(e){if(e.origin==t&&e.data&&"authorization_response"===e.data.type){var n=e.source;n&&n.close(),r&&console.log("[auth0-web-extension] received message from authorize iframe"),e.data.response.error?i(I.fromPayload(e.data.response)):o(e.data.response),clearTimeout(u),window.removeEventListener("message",a,!1),setTimeout(c,2e3)}},window.addEventListener("message",a,!1),window.document.body.appendChild(s),s.setAttribute("src",e)}))]}))}))};!function(e,t){var n;s(this,void 0,void 0,(function(){var r,o,i,s,c,u,l,d,h,g;return a(this,(function(a){switch(a.label){case 0:return r=new _,o=(t||{}).debug,i=void 0!==o&&o,window.location.origin+((null===(n=window.location.pathname)||void 0===n?void 0:n.length)>1?window.location.pathname:"")!==e?[3,10]:window.location.search.includes("code=")&&window.location.search.includes("state=")?(s=function(e){e.indexOf("#")>-1&&(e=e.slice(0,e.indexOf("#")));var t=e.split("&"),n={};return t.forEach((function(e){var t=e.split("="),r=t[0],o=t[1];r&&o&&(n[r]=decodeURIComponent(o))})),n.expires_in&&(n.expires_in=parseInt(n.expires_in)),n}(window.location.search.slice(1)),i&&console.log("[auth0-web-extension] Returning results"),[4,r.sendRuntimeMessage({type:"auth-result",payload:s})]):[3,2];case 1:return a.sent(),window.opener&&window.close(),[3,9];case 2:return[4,r.sendRuntimeMessage({type:"auth-params"})];case 3:c=a.sent(),u=c.authorizeUrl,l=c.domainUrl,i&&console.log("[auth0-web-extension] Creating /authorize url IFrame"),a.label=4;case 4:return a.trys.push([4,7,,9]),[4,re(u,l,60,i)];case 5:return d=a.sent(),[4,r.sendRuntimeMessage({type:"auth-result",payload:d})];case 6:return a.sent(),[3,9];case 7:return h=a.sent(),[4,r.sendRuntimeMessage({type:"auth-error",error:h})];case 8:return a.sent(),[3,9];case 9:return[3,11];case 10:r.addMessageListener((function(t){switch(t.type){case"auth-start":i&&console.log("[auth0-web-extension] Create redirect uri IFrame, v1 with redirectUri",e);var n=document.getElementById("auth-iframe");if(n)try{i&&console.log("[auth0-web-extension] Removing previous iframe",e),n.remove()}catch(e){i&&console.log("[auth0-web-extension] Failed to remove previous iframe: ",n)}return(g=document.createElement("iframe")).id="auth-iframe",g.setAttribute("width","0"),g.setAttribute("height","0"),g.style.display="none",document.body.appendChild(g),g.setAttribute("src",e),Promise.resolve();case"auth-cleanup":return i&&console.log("[auth0-web-extension] Cleaning up IFrame"),g&&window.document.body.removeChild(g),Promise.resolve();case"auth-ack":return i&&console.log("[auth0-web-extension] Received ack"),Promise.resolve("ack");default:throw i&&console.log("[auth0-web-extension] Unknown message",t),new Error("Unexpected message type ".concat(t.type))}})),a.label=11;case 11:return[2]}}))}))}("chrome-extension://kljjoeapehcmaphfcjkmbhkinoaopdnd/auth.html")})();